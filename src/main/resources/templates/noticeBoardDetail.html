<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--CSS Icon-->
    <link rel="stylesheet" href="/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="/vendors/css/vendor.bundle.base.css">
    <!--    CSS-->
    <link rel="stylesheet" href="/css/style.css">
    <!--JQuery-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tiny.cloud/1/bqgqrijaerjrvqx6r2vs05nhaoaxpsj2pi59vrvc6wc44eok/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <title>Ddait 사람들을 따듯하게 잇다</title>
    <style>
        /* 메시지 알림 스타일 추가 */
        .alert {
          padding: 15px;
          margin-bottom: 20px;
          border: 1px solid transparent;
          border-radius: 4px;
          text-align: center;
        }

        .alert-success {
          color: #155724;
          background-color: #d4edda;
          border-color: #c3e6cb;
        }

        .alert-error {
          color: #721c24;
          background-color: #f8d7da;
          border-color: #f5c6cb;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5;
        }
       /* 고정 사이드바 */
            .sidebar {
                position: fixed;
                bottom: 0px;
                height: 100vh;
                overflow-y: auto;
            }
        /* 메인 패널 기본 설정: 사이드바 너비 만큼 왼쪽 마진 */
        .main-panel {
          transition: margin-left 0.3s ease;
        }
        .page-body-wrapper {
            margin-right: 0px;
        }
        /* 읽기 전용 영역과 편집 영역의 스타일 동일하게 지정 */
        #viewMode, #editMode {
          min-height: 400px;   /* 필요에 따라 높이 조정 */
          padding: 20px;
<!--          border: 1px solid #dee2e6;-->
<!--          border-radius: 5px;-->
          background-color: #f8f9fa;
        }
        /* 초기 상태: 편집 영역와 취소 버튼 숨김 */
        #editMode, #cancelBtnDiv {
          display: none;
        }
    </style>
</head>
<body>
<div class="container-scroller d-flex">
    <!-- 분리한 사이드바(fragment) 포함 -->
    <div th:replace="~{layout/sidebarinproject :: sidebar}"></div>
    <div class="container-fluid page-body-wrapper">
        <!-- 분리한 네비게이션 바(fragment) 포함 -->
        <div th:replace="~{layout/navbar :: navbar}"></div>
        <div class="main-panel">
            <div class="content-wrapper"><!--여기부터-->
                <h1 class="mb-3">NoticeBoard Detail
                    <span class="float-end">
                        <a th:href="@{/projects/{projectId}/board/noticeboard(projectId=${projectId})}" class="btn btn-inverse-primary btn-fw">목록 보기</a>
                    </span>
                </h1>
                <!-- 읽기 전용 상세보기 영역 -->
                <div id="viewMode" class="card-body">
                    <div class="card mb-3" style="min-height: 380px;">
                        <div class="card-body">
                            <div class="row align-items-center mb-1">
                                <div class="col">
                                    <h4 th:text="${noticeBoard.title}">글제목</h4>
                                </div>
                                <div class="col text-end">
                                    <p class="text-muted mb-0" th:text="${#temporals.format(noticeBoard.modifiedDate, 'yyyy-MM-dd HH:mm')}">등록일</p>
                                </div>
                            </div>
                            <p><strong>작성자:</strong> <span th:text="${noticeBoard.cName}">작성자</span></p>
                            <p><span th:utext="${noticeBoard.contents}">내용</span></p>
                        </div>
                    </div>
                </div>
<!--                    <div class="card mb-3">-->
<!--                        <div class="card-body">-->
<!--                            &lt;!&ndash; 작성자 &ndash;&gt;-->
<!--                            <div class="row align-items-center mb-1">-->
<!--                                <div class="col">-->
<!--                                    <h4 th:text="${noticeBoard.title}">글제목</h4>-->
<!--                                </div>-->
<!--                                <div class="col text-end">-->
<!--                                    <p class="text-muted mb-0" th:text="${noticeBoard.modifiedDate}">등록일</p>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="col">-->
<!--                                <p><strong>작성자:</strong> <span th:text="${noticeBoard.cName}">작성자</span></p>-->
<!--                            </div>-->
<!--                            <p th:text="${noticeBoard.contents}">내용 내용</p>-->
<!--                            <textarea class="form-control" id="noticeContents" rows="10" readonly th:text="${noticeBoard.contents}" ></textarea>-->
<!--                        </div>-->
<!--                    </div>-->
                <!-- 인라인 편집 폼 (수정 모드) -->
                <div id="editMode">
                    <form id="updateForm" th:action="@{'/projects/{projectId}/board/noticeboard/update/' + ${noticeBoard.id}(projectId=${projectId})}" method="post">
                        <div class="mb-3">
                            <label for="editTitle" class="form-label">제목</label>
                            <input type="text" id="editTitle" name="title" class="form-control" th:value="${noticeBoard.title}" required>
                        </div>
                        <div class="mb-3">
                            <label for="editContents" class="form-label">내용</label>
                            <textarea id="editContents" name="contents" class="form-control" rows="3" th:text="${noticeBoard.contents}"></textarea>
                        </div>
                        <!-- 수정/저장 버튼은 하단 영역의 통합 버튼에서 처리합니다. -->
                    </form>
                </div>

                <!-- 하단 액션 버튼 영역 -->
                <div class="row mt-3">
                    <!-- 왼쪽 열: 취소 버튼 (편집 모드일 때만 표시) -->
                    <div class="col-6">
                        <div id="cancelBtnDiv">
                            <button class="btn btn-outline-danger btn-fw" onclick="cancelEditMode()">취소</button>
                        </div>
                    </div>
                    <!-- 오른쪽 열: 수정/저장 통합 버튼과 삭제 버튼 (항상 오른쪽에 정렬) -->
                    <div class="col-6 text-end">
                        <button
                                th:if="${noticeBoard.createdBy == (#authentication.principal instanceof T(org.springframework.security.oauth2.core.user.OAuth2User) ? #authentication.principal.attributes['email'] : #authentication.principal.username)}"
                                id="toggleEditSaveBtn" class="btn btn-warning me-2"
                                onclick="toggleEditSave()">수정</button>
                        <form
                                th:if="${noticeBoard.createdBy == (#authentication.principal instanceof T(org.springframework.security.oauth2.core.user.OAuth2User) ? #authentication.principal.attributes['email'] : #authentication.principal.username)}"
                                th:action="@{'/projects/{projectId}/board/noticeboard/delete/' + ${noticeBoard.id}(projectId=${projectId})}"
                                method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
                        </form>
                    </div>
                </div>
            </div>
            </div><!--여기까지-->
        </div>
    </div>
</div>
</div>

<script>
    function toggleEditSave() {
      var viewDiv = document.getElementById("viewMode");
      var editDiv = document.getElementById("editMode");
      var toggleBtn = document.getElementById("toggleEditSaveBtn");
      var cancelDiv = document.getElementById("cancelBtnDiv");

      // 읽기 전용 상태 -> 편집 상태로 전환
      if (editDiv.style.display === "none" || editDiv.style.display === "") {
        editDiv.style.display = "block";
        viewDiv.style.display = "none";
        toggleBtn.innerText = "저장";
        cancelDiv.style.display = "block"; // 취소 버튼 보이기
      } else {
        // 편집 상태 -> 저장 처리: 폼 제출
        document.getElementById("updateForm").submit();
      }
    }

    function cancelEditMode() {
      var viewDiv = document.getElementById("viewMode");
      var editDiv = document.getElementById("editMode");
      var toggleBtn = document.getElementById("toggleEditSaveBtn");
      var cancelDiv = document.getElementById("cancelBtnDiv");

      // 편집 모드 취소하고 읽기 전용 모드로 전환
      editDiv.style.display = "none";
      viewDiv.style.display = "block";
      toggleBtn.innerText = "수정";
      cancelDiv.style.display = "none";
    }

    tinymce.init({
        indent: false,
        pad_empty_with_br: true,
        selector: "#editContents",
        plugins: "preview searchreplace autolink autosave save directionality visualblocks visualchars fullscreen image link media codesample table charmap pagebreak nonbreaking anchor advlist lists wordcount help linkchecker emoticons",
        height: '700px',
        hidden_input: false,
        toolbar_sticky: true,
        content_style: `
            body {
                background: #fff;
            }

            @media (min-width: 840px) {
                html {
                    background: #eceef4;
                    min-height: 100%;
                    padding: 0 .5rem
                }

                body {
                    background-color: #fff;
                    box-shadow: 0 0 4px rgba(0, 0, 0, .15);
                    box-sizing: border-box;
                    margin: 1rem auto 0;
                    max-width: 820px;
                    min-height: calc(100vh - 1rem);
                    padding:4rem 6rem 6rem 6rem
                }
            }
        `,
    });
</script>

<!--Layout 필수 자바스크립트 경로-->
<!-- base:js -->
<script src="/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page-->
<script src="/vendors/chart.js/Chart.min.js"></script>
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page-->
<!-- inject:js -->
<script src="/js/off-canvas.js"></script>
<script src="/js/hoverable-collapse.js"></script>
<script src="/js/template.js"></script>
<!-- endinject -->
<!-- plugin js for this page -->
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page -->
<!-- Custom js for this page-->
<script src="/js/dashboard.js"></script>
<!-- End custom js for this page-->

</body>
</html>
