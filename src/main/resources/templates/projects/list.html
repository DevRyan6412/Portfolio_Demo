<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--CSS Icon-->
  <link rel="stylesheet" href="/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/vendors/css/vendor.bundle.base.css">
  <!--    CSS-->
  <link rel="stylesheet" href="/css/style.css">
  <!--JQuery-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="shortcut icon" href="../../images/favicon.png" />
  <title>Ddait 사람들을 따듯하게 잇다</title>
  <style>
    /* 메시지 알림 스타일 추가 */
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
      text-align: center;
    }

    .alert-success {
      color: #155724;
      background-color: #d4edda;
      border-color: #c3e6cb;
    }

    .alert-error {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }

    /* 캘린더 미리보기 스타일 */
    .calendar-preview-section {
      margin: 15px 0;
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .calendar-preview-section h2 {
      color: #333;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
    }

    .simple-calendar {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .simple-calendar th, .simple-calendar td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      vertical-align: top;
      height: 70px;
    }

    .simple-calendar th {
      background-color: #f0f0f0;
      font-weight: bold;
      height: 30px;
    }

    .simple-calendar .day-number {
      font-weight: bold;
      margin-bottom: 5px;
      text-align: right;
      font-size: 0.9em;
    }

    .simple-calendar .event {
      background-color: #28a745;
      color: white;
      padding: 2px 4px;
      margin-bottom: 3px;
      border-radius: 3px;
      font-size: 0.8em;
      text-align: left;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      cursor: pointer;
    }

    .calendar-view-link {
      display: block;
      text-align: right;
      margin-top: 10px;
      color: #007bff;
      text-decoration: none;
      font-size: 0.95em;
      font-weight: 500;
    }

    .calendar-view-link:hover {
      text-decoration: underline;
    }

    .calendar-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 10px;
    }

    .calendar-nav button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 5px 10px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 4px;
    }

    .calendar-nav .current-month {
      font-weight: bold;
      font-size: 1.1em;
      margin: 0 10px;
    }

    .calendar-today-btn {
      margin-left: 10px;
      background-color: #28a745;
    }

    /* 공지사항 & 이슈 미리보기 스타일 */
    .preview-sections {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .preview-section {
      background-color: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .preview-section h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 1.3em;
      font-weight: bold;
      text-align: center;
      border-bottom: 1px solid #ddd;
      padding-bottom: 10px;
    }

    .preview-list {
      list-style: none;
    }

    .preview-item {
      padding: 10px;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s;
    }

    .preview-item:hover {
      background-color: #f0f0f0;
    }

    .preview-item a {
      text-decoration: none;
      color: #333;
      display: block;
    }

    .preview-item-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .preview-item-meta {
      font-size: 0.85em;
      color: #666;
      display: flex;
      justify-content: space-between;
    }

    .more-link {
      display: block;
      text-align: right;
      margin-top: 10px;
      color: #007bff;
      text-decoration: none;
      font-size: 0.9em;
      font-weight: 500;
    }

    .more-link:hover {
      text-decoration: underline;
    }

    .no-items {
      padding: 20px;
      text-align: center;
      color: #999;
      font-style: italic;
    }
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f5f5f5;
    }
    /* 고정 사이드바 */
            .sidebar {
                position: fixed;
                bottom: 0px;
                height: 100vh;
                overflow-y: auto;
            }
        /* 메인 패널 기본 설정: 사이드바 너비 만큼 왼쪽 마진 */
        .main-panel {
          transition: margin-left 0.3s ease;
        }
        .page-body-wrapper {
            margin-right: 0px;
        }
  </style>
</head>
<body>
<div class="container-scroller d-flex">
  <!-- 분리한 사이드바(fragment) 포함 -->
  <div th:replace="~{layout/sidebarinproject :: sidebar}"></div>
  <div class="container-fluid page-body-wrapper">
    <!-- 분리한 네비게이션 바(fragment) 포함 -->
    <div th:replace="~{layout/navbar :: navbar}"></div>
    <div class="main-panel">
      <div class="content-wrapper">
        <h2 class="mb-4">프로젝트 목록</h2>
        <div class="text-end mb-3">
          <a th:href="@{/projects/create}" class="btn btn-primary">새 프로젝트 생성</a>
        </div>
        <!-- 역할 필터 버튼과 검색폼 영역 -->
        <div class="mb-3 d-flex justify-content-between align-items-center">
          <div>
            <!-- 역할 필터 버튼 -->
            <button type="button" class="btn btn-outline-secondary"
                    th:onclick="|location.href='@{/projects}'|">
              전체
            </button>
            <sec:authorize access="hasAuthority('ROLE_ADMIN')">
              <button type="button" class="btn btn-outline-warning"
                      th:onclick="|location.href='@{/projects(role='admin')}'|">
                Admin
              </button>
            </sec:authorize>
            <button type="button" class="btn btn-outline-primary"
                    th:onclick="|location.href='@{/projects(role='leader')}'|">
              Leader
            </button>
            <button type="button" class="btn btn-outline-info"
                    th:onclick="|location.href='@{/projects(role='member')}'|">
              Member
            </button>
          </div>
          <div>
            <!-- 검색 폼: 기존 role 파라미터를 유지하도록 hidden 필드 추가 -->
            <form th:action="@{/projects}" method="get" class="d-flex">
              <input type="date" name="startDate" class="form-control me-2" placeholder="시작일"
                     th:value="${param.startDate}" required>
              <input type="date" name="endDate" class="form-control me-2" placeholder="종료일"
                     th:value="${param.endDate}" required>
              <input type="hidden" name="role" th:value="${param.role}">
              <button type="submit" class="btn btn-success" style="min-width: 80px;">검색</button>
            </form>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <div th:if="${projects.empty}" class="alert alert-info">
              등록된 프로젝트가 없습니다.
            </div>
            <div th:unless="${projects.empty}">
              <table class="table">
                <thead>
                <tr>
                  <th>프로젝트명</th>
                  <th>설명</th>
                  <th>시작일</th>
                  <th>종료일</th>
                  <th>상태</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="project : ${projects}"
                    th:onclick="|location.href='@{/projects/{id}(id=${project.id})}'|"
                    style="cursor: pointer;">
                  <td th:text="${project.projectName}"></td>
                  <td th:text="${project.description}"></td>
                  <td th:text="${#temporals.format(project.startDate, 'yyyy-MM-dd')}"></td>
                  <td th:text="${#temporals.format(project.endDate, 'yyyy-MM-dd')}"></td>
                  <td th:text="${project.status}"></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Layout 필수 자바스크립트 경로-->
<!-- base:js -->
<script src="/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page-->
<script src="/vendors/chart.js/Chart.min.js"></script>
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page-->
<!-- inject:js -->
<script src="/js/off-canvas.js"></script>
<script src="/js/hoverable-collapse.js"></script>
<script src="/js/template.js"></script>
<!-- endinject -->
<!-- plugin js for this page -->
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page -->
<!-- Custom js for this page-->
<script src="/js/dashboard.js"></script>
<!-- End custom js for this page-->
</body>
</html>
