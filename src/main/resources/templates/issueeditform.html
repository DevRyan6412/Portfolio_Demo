<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--CSS Icon-->
  <link rel="stylesheet" href="/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/vendors/css/vendor.bundle.base.css">
  <!--    CSS-->
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <!--JQuery-->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="shortcut icon" href="/images/favicon.png" />
  <title>Ddait ì‚¬ëŒë“¤ì„ ë”°ë“¯í•˜ê²Œ ì‡ë‹¤</title>
  <style>
    /* ë©”ì‹œì§€ ì•Œë¦¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
      text-align: center;
    }

    .alert-success {
      color: #155724;
      background-color: #d4edda;
      border-color: #c3e6cb;
    }

    .alert-error {
      color: #721c24;
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background-color: #f5f5f5;
    }
    /* ê³ ì • ì‚¬ì´ë“œë°” */
            .sidebar {
                position: fixed;
                bottom: 0px;
                height: 100vh;
                overflow-y: auto;
            }
    /* ë©”ì¸ íŒ¨ë„ ê¸°ë³¸ ì„¤ì •: ì‚¬ì´ë“œë°” ë„ˆë¹„ ë§Œí¼ ì™¼ìª½ ë§ˆì§„ */
    .main-panel {
      transition: margin-left 0.3s ease;
    }
    .page-body-wrapper {
      margin-right: 0px;
    }
  </style>
</head>
<body>
<div class="container-scroller d-flex">
  <!-- ë¶„ë¦¬í•œ ì‚¬ì´ë“œë°”(fragment) í¬í•¨ -->
  <div th:replace="~{layout/sidebarinproject :: sidebar}"></div>
  <div class="container-fluid page-body-wrapper">
    <!-- ë¶„ë¦¬í•œ ë„¤ë¹„ê²Œì´ì…˜ ë°”(fragment) í¬í•¨ -->
    <div th:replace="~{layout/navbar :: navbar}"></div>
    <div class="main-panel">
      <div class="content-wrapper"><!--ì—¬ê¸°ë¶€í„°-->


        <h2>ì´ìŠˆ ìˆ˜ì •</h2>

        <!-- âœ… ê¸°ì¡´ ìˆ˜ì • & íŒŒì¼ ì—…ë¡œë“œë¥¼ í•œ ë²ˆì— ì²˜ë¦¬ -->
        <form th:action="@{/projects/{projectId}/board/issues/update/{id}(projectId=${projectId}, id=${issue.id})}"
              method="post" enctype="multipart/form-data">

          <!-- ì œëª© ì…ë ¥ -->
          <div class="mb-3">
            <label for="title" class="form-label">ì œëª©</label>
            <input type="text" class="form-control" id="title" name="title" th:value="${issue.title}" required>
          </div>

          <!-- ë‚´ìš© ì…ë ¥ -->
          <div class="mb-3">
            <label for="content" class="form-label">ë‚´ìš©</label>
            <textarea class="form-control" id="content" name="content" rows="5" th:text="${issue.content}" required></textarea>
          </div>

          <!-- âœ… ì´ìŠˆ ìƒíƒœ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì¶”ê°€ -->
          <div class="mb-3">
            <label for="status" class="form-label">ì´ìŠˆ ìƒíƒœ</label>
            <select class="form-select" id="status" name="status">
              <option value="IN_PROGRESS" th:selected="${issue.status == 'IN_PROGRESS'}">ì§„í–‰ ì¤‘</option>
              <option value="COMPLETED" th:selected="${issue.status == 'COMPLETED'}">ì™„ë£Œ</option>
              <option value="ON_HOLD" th:selected="${issue.status == 'ON_HOLD'}">ë³´ë¥˜</option>
            </select>
          </div>

          <!-- âœ… ê¸°ì¡´ íŒŒì¼ ëª©ë¡ (ì‚­ì œ ë²„íŠ¼ í¬í•¨) -->
          <div class="mb-3">
            <label class="form-label">ì²¨ë¶€ëœ íŒŒì¼</label>
            <ul class="list-group">
              <li th:each="file : ${issue.files}" class="list-group-item d-flex justify-content-between align-items-center">
                <a th:text="${file.fileName}" th:href="@{/api/files/download/{fileId}(fileId=${file.id})}" class="text-decoration-none"></a>
                <button type="button" class="btn btn-danger btn-sm delete-file-btn" th:data-file-id="${file.id}">ì‚­ì œ</button>
              </li>
            </ul>
          </div>

          <!-- âœ… ìƒˆ íŒŒì¼ ì—…ë¡œë“œ -->
          <div class="mb-3">
            <label for="newFiles" class="form-label">ìƒˆë¡œìš´ íŒŒì¼ ì¶”ê°€</label>
            <input type="file" class="form-control" id="newFiles" name="newFiles" multiple>
          </div>

          <!-- ìˆ˜ì • ë²„íŠ¼ -->
          <button type="submit" class="btn btn-primary">ìˆ˜ì •</button>
        </form>

      </div><!--ì—¬ê¸°ê¹Œì§€-->
    </div>
  </div>
</div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".delete-file-btn").forEach(button => {
      button.addEventListener("click", function () {
        const fileId = this.getAttribute("data-file-id");
        if (confirm("ì •ë§ë¡œ ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          // fileId ì¸ì½”ë”© ì¶”ê°€
          const encodedFileId = encodeURIComponent(fileId);

          fetch(`/api/files/delete/${encodedFileId}`, {
            method: "POST",
            headers: {
              'Content-Type': 'application/json'
            }
          })
                  .then(response => {
                    if (!response.ok) {
                      console.error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                      throw new Error(`íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨ (HTTP ${response.status})`);
                    }
                    location.reload();
                  })
                  .catch(error => {
                    console.error("íŒŒì¼ ì‚­ì œ ì˜¤ë¥˜:", error);
                    alert("íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
                  });
        }
      });
    });
  });
</script>

<!--Layout í•„ìˆ˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ-->
<!-- base:js -->
<script src="/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page-->
<script src="/vendors/chart.js/Chart.min.js"></script>
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page-->
<!-- inject:js -->
<script src="/js/off-canvas.js"></script>
<script src="/js/hoverable-collapse.js"></script>
<script src="/js/template.js"></script>
<!-- endinject -->
<!-- plugin js for this page -->
<script src="/js/jquery.cookie.js" type="text/javascript"></script>
<!-- End plugin js for this page -->
<!-- Custom js for this page-->
<script src="/js/dashboard.js"></script>
<!-- End custom js for this page-->

</body>
</html>



<!--&lt;!&ndash;ğŸ”¹ ê¸°ëŠ¥ ìš”ì•½-->
<!--ê¸°ì¡´ ì´ìŠˆì˜ ì œëª©ê³¼ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€.-->

<!--ğŸ”¹ êµ¬í˜„ëœ ê¸°ëŠ¥-->
<!--âœ… ê¸°ì¡´ ì´ìŠˆ ë°ì´í„° í‘œì‹œ-->
<!--â†’ th:value="${issue.title}" (ì œëª©)-->
<!--â†’ th:text="${issue.content}" (ë‚´ìš©)-->
<!--âœ… ì´ìŠˆ ìˆ˜ì • ìš”ì²­ ì²˜ë¦¬-->
<!--â†’ th:action="@{/projects/{projectId}/board/issues/update/{id}(projectId=${projectId}, id=${issue.id})}"-->
<!--âœ… ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€ (ì´ìŠˆ ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™)-->
<!--â†’ th:href="@{/projects/{projectId}/board/issues(projectId=${projectId})}"-->

<!--&ndash;&gt;-->
